{% load static %}

<!doctype html>
<html lang="en" data-theme="light">
<head>
  <meta charset="UTF-8">
  <script>
    // Apply theme immediately to prevent flash of white
    (function() {
      var theme = localStorage.getItem('theme') || 'light';
      document.documentElement.setAttribute('data-theme', theme);
    })();
  </script>
  <meta name="viewport"
        content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

  <title>{% block title %}My Site{% endblock %}</title>

  {% block css_files %}
    <link rel="stylesheet" href="{% static 'css/style.css' %}">
  {% endblock %}

  {% block extra_head %}
  {% endblock %}
</head>
<body>

{% include 'includes/navbar.html' %}

<div class="container mt-4">
  {% block content %}
  {% endblock %}
</div>

{% include 'includes/footer.html' %}

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/react@17/umd/react.production.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/react-dom@17/umd/react-dom.production.min.js"></script>
<script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>

{% block js_files %}
  <script src="{% static 'js/script.js' %}"></script>
{% endblock %}

<!-- Theme Toggle Script -->
<script>
  // Theme toggle functionality
  (function() {
    // Get saved theme or default to light
    const savedTheme = localStorage.getItem('theme') || 'light';
    document.documentElement.setAttribute('data-theme', savedTheme);

    // Toggle theme function
    window.toggleTheme = function() {
      const currentTheme = document.documentElement.getAttribute('data-theme');
      const newTheme = currentTheme === 'dark' ? 'light' : 'dark';

      document.documentElement.setAttribute('data-theme', newTheme);
      localStorage.setItem('theme', newTheme);

      // Update Chart.js colors if charts exist
      updateChartColors(newTheme);
    };

    // Update Chart.js colors for theme
    window.updateChartColors = function(theme) {
      if (typeof Chart !== 'undefined') {
        const textColor = theme === 'dark' ? '#9ca3af' : '#666';
        const gridColor = theme === 'dark' ? 'rgba(255, 255, 255, 0.1)' : 'rgba(0, 0, 0, 0.1)';

        Chart.defaults.color = textColor;
        Chart.defaults.borderColor = gridColor;

        // Update all existing charts
        Chart.helpers.each(Chart.instances, function(chart) {
          if (chart.options.scales) {
            Object.keys(chart.options.scales).forEach(function(scaleKey) {
              if (chart.options.scales[scaleKey].grid) {
                chart.options.scales[scaleKey].grid.color = gridColor;
              }
              if (chart.options.scales[scaleKey].ticks) {
                chart.options.scales[scaleKey].ticks.color = textColor;
              }
              if (chart.options.scales[scaleKey].title) {
                chart.options.scales[scaleKey].title.color = textColor;
              }
            });
          }
          if (chart.options.plugins && chart.options.plugins.legend) {
            chart.options.plugins.legend.labels = chart.options.plugins.legend.labels || {};
            chart.options.plugins.legend.labels.color = textColor;
          }
          if (chart.options.plugins && chart.options.plugins.title) {
            chart.options.plugins.title.color = textColor;
          }
          chart.update();
        });
      }
    };

    // Apply theme on page load
    document.addEventListener('DOMContentLoaded', function() {
      updateChartColors(savedTheme);
    });
  })();
</script>

{% block extra_body %}
{% endblock %}

</body>
</html>
